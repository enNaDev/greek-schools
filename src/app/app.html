<div class="mb-4 p-8">
  @if (metaData(); as metaData) {
    <p-card [header]="metaData.description" class="mb-4">
      <p class="m-0">
        @if (lastUpdate(); as lastUpdate) {
          Τελευταία ενημέρωση: <p-tag severity="info" [value]="lastUpdate" [rounded]="true" />
        }
      </p>
      <ng-template #footer>
        <div class="flex gap-4 mt-1">
          Πάροχος πληροφοριών: 
          <a href="https://data.gov.gr/datasets/minedu_schools" pButton target="_blank" rel="noopener noreferrer">
            <span pButtonLabel>{{ metaData.provider.name }}</span>
          </a>
        </div>
      </ng-template>
    </p-card>
  }
  
  <div class="card">
    <p-table
      #dt2
      [value]="schools()"
      [rows]="10"
      [rowsPerPageOptions]="[10, 25, 50]"
      [loading]="loading()"
      [paginator]="true"
      [globalFilterFields]="globalFilterFields()"
      [tableStyle]="{ 'min-width': '75rem' }"
    >
      <ng-template #caption>
        <div class="flex">
          <p-iconfield iconPosition="left" class="ml-auto">
            <p-inputicon>
              <i class="pi pi-search"></i>
            </p-inputicon>
            <input
              pInputText
              type="text"
              placeholder="Αναζήτηση"
              (input)="dt2.filterGlobal($event.target.value, 'contains')"
            />
          </p-iconfield>
        </div>
      </ng-template>
      <ng-template #header>
        <tr>
          <th>Α/Α</th>
          @for (key of fields(); track key) {
            <th>{{ key.title }}</th>
          }
        </tr>
        <tr>
          <th>
            <!-- Α/Α -->
          </th>
          @for (key of fields(); track key) {
            <th>
              <p-columnFilter
                type="text"
                [field]="key.name"
                [placeholder]="'Αναζήτηση ανά ' + key.title.toLowerCase()"
                [ariaLabel]="key.title">
              </p-columnFilter>
            </th>
          }
        </tr>
      </ng-template>
      <ng-template #body let-rowIndex="rowIndex" let-school>
        <tr>
          <td>
            {{ rowIndex + 1 }}
          </td>
          @for (key of fields(); track key) {
            <td>
              {{ school[key.name] }}
            </td>
          }
        </tr>
      </ng-template>
      <ng-template #emptymessage>
        <tr>
          <td colspan="5">Δεν βρέθηκαν σχολεία.</td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>
